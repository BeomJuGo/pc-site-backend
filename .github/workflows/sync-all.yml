name: Daily Sync All Parts

on:
  schedule:
    # ë§¤ì¼ í•œêµ­ì‹œê°„ ì˜¤ì „ 3ì‹œ ì‹¤í–‰ â†’ UTC 18:00 (ì „ë‚ )
    - cron: "0 18 * * *"
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼

jobs:
  sync-all:
    runs-on: ubuntu-latest
    timeout-minutes: 60  # ëª¨ë“  ë¶€í’ˆ ë™ê¸°í™”ëŠ” ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆìŒ

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm install

      - name: Run sync-all script
        env:
          API_BASE_URL: https://pc-site-backend.onrender.com
        run: node sync-all.js

      - name: Update prices
        if: success()
        run: |
          echo "ğŸ”„ ê°€ê²© ì—…ë°ì´íŠ¸ ì‹œì‘..."
          http_code=$(curl -sS -o /tmp/resp.txt -w "%{http_code}" \
            -X POST "https://pc-site-backend.onrender.com/api/admin/update-prices" \
            -H "Content-Type: application/json") || true
          
          echo "HTTP $http_code"
          cat /tmp/resp.txt || true
          
          if [ "$http_code" -ge 200 ] && [ "$http_code" -lt 300 ]; then
            echo "âœ… ê°€ê²© ì—…ë°ì´íŠ¸ ì„±ê³µ"
          else
            echo "âš ï¸ ê°€ê²© ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ (HTTP $http_code)"
          fi

